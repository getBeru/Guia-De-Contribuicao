# Guia de Contribui√ß√£o ‚Äî Tema Beru (Neovim)

Este documento explica **como o tema funciona por dentro**, **o que pode ou n√£o ser alterado**, e **como contribuir corretamente** sem cair em armadilhas comuns do Treesitter e Neovim.

A ideia √© simples: qualquer melhoria deve vir via **Pull Request**, com clareza t√©cnica e sem tentativa no escuro.

---

## 1. Vis√£o geral do projeto

O Beru para Neovim √© um **tema baseado em Lua** que usa:

- **Treesitter** para highlighting sem√¢ntico
- **LSP Semantic Tokens** para informa√ß√£o contextual
- **Syntax tradicional** como fallback

Fluxo geral:

```
palette.lua ‚Üí highlights.lua ‚Üí Neovim
```

Tudo que voc√™ altera visualmente **passa pelo arquivo `highlights.lua`**.

---

## 2. Como funciona a defini√ß√£o de cores

### 2.1 Palette (paleta de cores)

As cores s√£o definidas em `lua/beru/palette.lua`:

```lua
M.palette = {
    bg = "#101010",
    fg = "#BABABA",
    red = "#EF4444",
    -- ...
}
```

‚ö†Ô∏è **Regra de ouro:**
* Sempre use vari√°veis da palette (`p.red`, `p.blue`)
* NUNCA hardcode cores hexadecimais diretamente nos highlights
* Se precisar de uma nova cor, adicione na palette primeiro

---

## 3. Ordem das regras importa (muito)

Assim como no VS Code, no Neovim **a ordem importa**.

> A √∫ltima regra que bate em um grupo de highlight **vence**.

Por isso:

* Regras gen√©ricas (`@variable`, `@keyword`, `@function`) devem vir primeiro
* Regras espec√≠ficas (`@variable.javascript`, `@keyword.storage`) devem vir depois
* Overrides de linguagens espec√≠ficas devem estar no final

**Exemplo correto:**

```lua
["@variable"] = { fg = p.string_blue },  -- Geral
["@variable.javascript"] = { fg = p.string_blue },  -- Espec√≠fico
["@variable.builtin"] = { fg = p.blue, italic = true },  -- Override
```

---

## 4. Como o Treesitter realmente funciona

Esse √© o ponto mais importante do projeto.

### 4.1 Limita√ß√µes do Treesitter

#### ‚ùå N√£o √© poss√≠vel diferenciar tags HTML por contexto

```jsx
<Card>  {/* componente customizado */}
  <img />  {/* tag HTML nativa */}
</Card>
```

No VS Code, `Card` √© amarelo e `img` √© azul.  
No Neovim, **ambos usam o mesmo scope** `@tag`.

**Solu√ß√£o:** Usamos `@constructor` para componentes customizados quando dispon√≠vel.

#### ‚ùå N√£o √© poss√≠vel separar keywords por tipo

```javascript
const x = 1;  // keyword de storage
return x;     // keyword de controle
```

Ambos s√£o `@keyword`. **N√£o tem como colorir s√≥ `const` de azul e `return` de vermelho.**

#### ‚ùå CSS/SCSS tem parsing limitado

```scss
font-size: 22px;  // "22px" √© um token √∫nico
```

N√£o existe scope separado para `px`, `em`, `rem`, etc.  
Isso √© uma limita√ß√£o do parser Treesitter de CSS.

---

### 4.2 O que √â poss√≠vel fazer

‚úÖ **Vari√°veis**
```lua
["@variable"] = { fg = p.string_blue }
["@variable.builtin"] = { fg = p.blue }
```

‚úÖ **Propriedades**
```lua
["@property"] = { fg = p.string_blue }
```

‚úÖ **Fun√ß√µes**
```lua
["@function"] = { fg = p.yellow }
["@function.call"] = { fg = p.yellow }
```

‚úÖ **Keywords gerais**
```lua
["@keyword"] = { fg = p.red }
["@keyword.function"] = { fg = p.blue }
```

‚úÖ **Tags e atributos**
```lua
["@tag"] = { fg = p.yellow }
["@tag.attribute"] = { fg = p.string_blue }
```

‚úÖ **Por linguagem**
```lua
["@variable.javascript"] = { fg = p.string_blue }
["@variable.python"] = { fg = p.fg }
```

---

## 5. Como descobrir o scope correto

**SEMPRE fa√ßa isso antes de abrir um PR:**

### M√©todo 1: Treesitter Playground

1. Instale `nvim-treesitter/playground`
2. Execute `:TSPlaygroundToggle`
3. Posicione o cursor no elemento
4. Veja o capture name na janela do playground

### M√©todo 2: Inspect

1. Execute `:Inspect`
2. Posicione o cursor no elemento
3. Veja os highlight groups aplicados

### M√©todo 3: InspectTree

1. Execute `:InspectTree`
2. Navegue pela √°rvore sint√°tica
3. Encontre o node correspondente

**PRs sem verifica√ß√£o de scope real N√ÉO ser√£o aceitos.**

---

## 6. Onde colocar regras novas

### 6.1 Regras gen√©ricas

‚û°Ô∏è Colocar na se√ß√£o `-- Treesitter` ou `-- Syntax (base)`

```lua
["@variable"] = { fg = p.string_blue },
["@function"] = { fg = p.yellow },
```

### 6.2 Regras espec√≠ficas de linguagem

‚û°Ô∏è Colocar nas se√ß√µes espec√≠ficas:

```lua
-- ========================================================================
-- JavaScript/TypeScript
-- ========================================================================
["@variable.javascript"] = { fg = p.string_blue },
```

### 6.3 Regras de plugins

‚û°Ô∏è Colocar nas se√ß√µes de plugins:

```lua
-- ========================================================================
-- Telescope
-- ========================================================================
TelescopeSelection = { fg = p.fg, bg = p.selection },
```

---

## 7. Como testar suas mudan√ßas

### 7.1 Desenvolvimento local

```lua
-- Em seu init.lua
vim.opt.runtimepath:prepend("~/caminho/para/beru.nvim")
vim.cmd([[colorscheme beru]])
```

### 7.2 Recarregar o tema

```vim
:lua package.loaded['beru'] = nil
:lua package.loaded['beru.palette'] = nil
:lua package.loaded['beru.highlights'] = nil
:colorscheme beru
```

Ou simplesmente reinicie o Neovim.

### 7.3 Arquivos de teste

Crie arquivos de exemplo para cada linguagem que voc√™ modificou:

```
test/
‚îú‚îÄ‚îÄ test.js
‚îú‚îÄ‚îÄ test.tsx
‚îú‚îÄ‚îÄ test.css
‚îî‚îÄ‚îÄ test.lua
```

---

## 8. Padr√£o para Pull Requests

Todo PR **DEVE** conter:

### ‚úÖ Obrigat√≥rio

1. **Descri√ß√£o clara do problema visual**
   - "Vari√°veis em JavaScript est√£o brancas, deveriam ser ciano"

2. **Scope real usado**
   - Copiado do `:Inspect` ou Treesitter Playground
   - Exemplo: `@variable.javascript`

3. **Screenshots antes/depois**
   - Pelo menos 2 imagens comparando

4. **Arquivos de teste**
   - Se modificou JS, inclua um `test.js`

### ‚ùå Ser√° rejeitado se

1. Tentar contornar limita√ß√µes fundamentais do Treesitter
2. N√£o tiver screenshots
3. N√£o especificar o scope usado
4. Quebrar highlights existentes
5. Usar cores hardcoded ao inv√©s da palette

---

## 9. Filosofia do tema

O Beru segue tr√™s princ√≠pios:

### 1. Respeitar limita√ß√µes do Treesitter

N√£o tentamos "hackear" o sistema.  
Se algo n√£o √© poss√≠vel, documentamos e seguimos em frente.

### 2. Consist√™ncia visual

Preferimos consist√™ncia a tentar imitar 100% o VS Code.  
Se uma cor n√£o pode ser exata, escolhemos a mais pr√≥xima e mantemos em todo o tema.

### 3. Clareza t√©cnica

C√≥digo limpo, bem comentado e organizado.  
Nada de "funciona mas n√£o sei por qu√™".

---

## 10. Checklist antes de enviar PR

- [ ] Testei em um arquivo real da linguagem
- [ ] Verifiquei o scope com `:Inspect`
- [ ] Adicionei screenshots antes/depois
- [ ] Segui a estrutura de se√ß√µes do arquivo
- [ ] Usei cores da palette
- [ ] N√£o quebrei highlights existentes
- [ ] Li este guia completamente

---

## 11. Exemplos de bons PRs

### ‚úÖ Exemplo 1: Adicionar suporte a Python

```markdown
## Problema
Vari√°veis em Python est√£o brancas, deveriam ser ciano como em JS.

## Scope usado
`@variable.python` (verificado com `:Inspect`)

## Mudan√ßa
```lua
["@variable.python"] = { fg = p.string_blue },
["@parameter.python"] = { fg = p.string_blue, italic = true },
```

## Screenshots
[antes.png] [depois.png]

## Arquivo de teste
test/test.py
```

### ‚úÖ Exemplo 2: Melhorar suporte a Rust

```markdown
## Problema
Macros em Rust n√£o t√™m highlighting, ficam da cor padr√£o.

## Scope usado
`@function.macro.rust` (via Treesitter Playground)

## Mudan√ßa
```lua
["@function.macro.rust"] = { fg = p.purple },
```

## Screenshots
[antes.png] [depois.png]
```

---

## 12. Exemplos de PRs que ser√£o rejeitados

### ‚ùå Exemplo 1: "Deixar s√≥ const azul"

```markdown
Quero deixar `const` azul mas `return` vermelho.
```

**Resposta:** N√£o √© poss√≠vel. Ambos s√£o `@keyword` no Treesitter.  
Leia a se√ß√£o 4.1 deste guia.

### ‚ùå Exemplo 2: "Colorir unidades CSS separadamente"

```markdown
Quero que `22` seja verde e `px` seja azul em `22px`.
```

**Resposta:** `22px` √© um token √∫nico no Treesitter de CSS.  
N√£o √© poss√≠vel separar.

### ‚ùå Exemplo 3: PR sem screenshots

```markdown
Mudei umas cores.

```lua
["@variable"] = { fg = "#FF0000" }
```
```

**Resposta:** 
1. Sem screenshots
2. Sem explica√ß√£o
3. Cor hardcoded (deveria usar palette)

---

## 13. Como adicionar suporte a um novo plugin

### Exemplo: Adicionar suporte ao plugin "X"

1. **Descubra os highlight groups do plugin**
   ```vim
   :so $VIMRUNTIME/syntax/hitest.vim
   ```

2. **Crie uma se√ß√£o no arquivo**
   ```lua
   -- ========================================================================
   -- Plugin X
   -- ========================================================================
   PluginXNormal = { fg = p.fg, bg = p.bg_dark },
   PluginXSelected = { fg = p.fg, bg = p.selection },
   ```

3. **Teste com o plugin instalado**

4. **Documente no README**

---

## 14. Estrutura de commits

Use commits sem√¢nticos:

```
feat: adiciona suporte a Python
fix: corrige cor de vari√°veis em TypeScript
docs: atualiza README com novos plugins
style: reorganiza se√ß√£o de CSS
refactor: simplifica l√≥gica de highlights
```

---

## 15. Se algo "n√£o muda"

Se voc√™ est√° tentando mudar algo e n√£o funciona:

1. ‚úÖ Verificou o scope com `:Inspect`?
2. ‚úÖ O Treesitter est√° instalado e habilitado?
3. ‚úÖ Voc√™ recarregou o tema?
4. ‚úÖ N√£o h√° outro plugin sobrescrevendo?

Se depois disso ainda n√£o funciona:

> **Provavelmente n√£o existe scope espec√≠fico para isso.**

Isso n√£o √© erro seu ‚Äî √© uma limita√ß√£o do Treesitter.  
Documente e siga em frente.

---

## 16. Recursos √∫teis

### Documenta√ß√£o oficial

- [Neovim Treesitter](https://github.com/nvim-treesitter/nvim-treesitter)
- [Treesitter Highlight Groups](https://neovim.io/doc/user/treesitter.html#treesitter-highlight-groups)
- [LSP Semantic Tokens](https://neovim.io/doc/user/lsp.html#lsp-semantic-highlight)

### Ferramentas

- [nvim-treesitter/playground](https://github.com/nvim-treesitter/playground) ‚Äî Inspe√ß√£o visual
- [Inspect Commands](https://neovim.io/doc/user/treesitter.html#%3AInspect) ‚Äî `:Inspect`, `:InspectTree`

### Temas de refer√™ncia

- [Tokyo Night](https://github.com/folke/tokyonight.nvim) ‚Äî Excelente estrutura
- [Catppuccin](https://github.com/catppuccin/nvim) ‚Äî √ìtima organiza√ß√£o
- [Gruvbox Material](https://github.com/sainnhe/gruvbox-material) ‚Äî Suporte extensivo

---

## 17. Conclus√£o

Melhorias s√£o **muito bem-vindas**.  
Tentativas no escuro, n√£o.

Se voc√™ leu este guia at√© aqui, est√° pronto para contribuir! üöÄ

Qualquer d√∫vida, abra uma issue primeiro antes de fazer o PR.

---

**Bem-vindo ao projeto!**

Co-authored-by: ComunidadeFullDev <contato@fulldev.com.br>
